<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lyra Admin Panel</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #panel { display: none; }
        textarea { width: 100%; height: 80px; }
        .section { margin-bottom: 20px; }
        #chatOutput { border: 1px solid #ccc; padding: 10px; height: 150px; overflow-y: auto; }
    </style>
</head>
<body>
    <div id="login">
        <h2>Admin Login</h2>
        <input type="password" id="password" placeholder="Password" />
        <button id="loginBtn">Login</button>
    </div>

    <div id="panel">
        <h1>Lyra Admin Panel</h1>

        <div class="section">
            <h3>Chat</h3>
            <div id="chatOutput"></div>
            <textarea id="chatInput" placeholder="Type a message..."></textarea>
            <button id="sendChat">Send</button>
            <button id="listenBtn">Listen</button>
        </div>

        <div class="section">
            <h3>Terminal</h3>
            <textarea id="cmdInput" placeholder="Command"></textarea>
            <button id="runCmd">Run</button>
            <pre id="cmdOutput"></pre>
        </div>

        <div class="section">
            <h3>Daily Report</h3>
            <button id="reportBtn">Fetch Report</button>
            <pre id="reportOutput"></pre>
        </div>
    </div>

    <script>
    async function login(){
        const pw = document.getElementById('password').value;
        const res = await fetch('/verify_admin', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({password: pw})
        });
        const data = await res.json();
        if(data.access){
            document.getElementById('login').style.display='none';
            document.getElementById('panel').style.display='block';
        } else {
            alert('Access denied');
        }
    }
    document.getElementById('loginBtn').onclick = login;

    async function speak(text, mood='neutral'){
        const res = await fetch('/speak',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({text, mood})
        });
        const blob = await res.blob();
        new Audio(URL.createObjectURL(blob)).play();
    }

    async function sendChat(){
        const text = document.getElementById('chatInput').value;
        const res = await fetch('/chat',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({text})
        });
        const data = await res.json();
        const output = document.getElementById('chatOutput');
        output.innerHTML += `<p><b>You:</b> ${text}</p>`;
        output.innerHTML += `<p><b>Lyra:</b> ${data.response}</p>`;
        speak(data.response);
        output.scrollTop = output.scrollHeight;
    }
    document.getElementById('sendChat').onclick = sendChat;

    async function listen(){
        const res = await fetch('/listen');
        const data = await res.json();
        document.getElementById('chatInput').value = data.transcript || '';
    }
    document.getElementById('listenBtn').onclick = listen;

    async function runCmd(){
        const cmd = document.getElementById('cmdInput').value;
        const res = await fetch('/terminal',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({command: cmd})
        });
        const data = await res.json();
        document.getElementById('cmdOutput').textContent = data.output;
    }
    document.getElementById('runCmd').onclick = runCmd;

    async function getReport(){
        const res = await fetch('/daily_report');
        const data = await res.json();
        document.getElementById('reportOutput').textContent = data.report;
    }
    document.getElementById('reportBtn').onclick = getReport;
    </script>
</body>
</html>
