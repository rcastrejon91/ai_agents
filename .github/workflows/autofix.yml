name: Autofix Starter
on:
  workflow_dispatch: {}
  push:
    branches: [ main ]
permissions:
  contents: write

jobs:
  autofix:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # JS/TS (only if package.json exists)
      - uses: actions/setup-node@v4
        if: ${{ hashFiles('package.json') != '' }}
        with: { node-version: 'lts/*' }
      - name: ESLint + Prettier (JS/TS)
        if: ${{ hashFiles('package.json') != '' }}
        run: |
          npm ci || npm install
          npx --yes eslint . --fix || true
          npx --yes prettier . --write || true

      # Python (only if *.py exists)
      - uses: actions/setup-python@v5
        if: ${{ hashFiles('**/*.py') != '' }}
        with: { python-version: '3.11' }
      - name: Ruff/Black/isort (Py)
        if: ${{ hashFiles('**/*.py') != '' }}
        run: |
          python -m pip install --upgrade pip
          pip install ruff black isort || true
          ruff check . --fix || true
          isort . || true
          black . || true

      - name: Commit changes (if any)
        run: |
          if git status --porcelain | grep .; then
            git config user.name "autofix-bot"
            git config user.email "autofix-bot@users.noreply.github.com"
            git checkout -b "autofix/${GITHUB_RUN_ID}"
            git add -A && git commit -m "chore: autofix" && git push -u origin HEAD
          fi