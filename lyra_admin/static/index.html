<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lyra Admin Command Center</title>
<style>
    body { font-family: Arial, sans-serif; background: #101010; color: #fff; margin: 0; }
    header { padding: 15px; background: #222; text-align: center; }
    h1 { margin: 0; color: #4CAF50; }
    #loginPanel, #adminPanel { max-width: 800px; margin: auto; padding: 20px; }
    input, button { padding: 8px; margin: 5px; border-radius: 4px; border: none; }
    button { cursor: pointer; }
    textarea { width: 100%; height: 150px; background: #000; color: #0f0; font-family: monospace; padding: 10px; }
    .hidden { display: none; }
</style>
</head>
<body>
<header>
    <h1>🔐 Lyra Admin Command Center</h1>
</header>

<div id="loginPanel">
    <h2>Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Enter Admin Password">
    <button onclick="verifyAdmin()">Login</button>
    <p id="loginStatus"></p>
</div>

<div id="adminPanel" class="hidden">
    <h2>Welcome, Ricky 👋</h2>
    <button onclick="lyraLearn()">📚 Trigger Learning</button>
    <button onclick="fetchDailyReport()">📅 Get Daily Report</button>
    <button onclick="lyraSpeakPrompt()">🗣 Speak</button>
    <button onclick="lyraListen()">🎤 Listen</button>

    <h3>📜 Output Log</h3>
    <div id="chatLog" style="background:#111; padding:10px; height:200px; overflow:auto;"></div>

    <h3>💻 Terminal</h3>
    <textarea id="terminalOutput" readonly></textarea><br>
    <input type="text" id="terminalInput" placeholder="Type a command">
    <button onclick="runCommand()">Run</button>
</div>

<script>
const LYRA_API_URL = "http://localhost:5000";
let isMuted = false;
let currentMood = "neutral";

function verifyAdmin() {
    const password = document.getElementById("adminPass").value;
    fetch(`${LYRA_API_URL}/verify_admin`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password })
    })
    .then(res => res.json())
    .then(data => {
        if (data.access) {
            document.getElementById("loginPanel").classList.add("hidden");
            document.getElementById("adminPanel").classList.remove("hidden");
        } else {
            document.getElementById("loginStatus").innerText = "❌ Wrong password";
        }
    });
}

function lyraLearn() {
    fetch(`${LYRA_API_URL}/learn`, { method: "POST" })
        .then(res => res.json())
        .then(data => appendMessage("System", data.status));
}

function fetchDailyReport() {
    fetch(`${LYRA_API_URL}/daily_report`)
        .then(res => res.json())
        .then(data => appendMessage("📅 Lyra Daily Report", data.report));
}

function lyraSpeakPrompt() {
    const msg = prompt("What should Lyra say?");
    if (msg) lyraSpeak(msg);
}

async function lyraSpeak(text, mood = currentMood) {
    if (isMuted) return;
    const res = await fetch(`${LYRA_API_URL}/speak`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text, mood })
    });
    const audioBlob = await res.blob();
    const audioUrl = URL.createObjectURL(audioBlob);
    new Audio(audioUrl).play();
}

function lyraListen() {
    fetch(`${LYRA_API_URL}/listen`)
        .then(res => res.json())
        .then(data => appendMessage("🎤 You said", data.transcript));
}

function runCommand() {
    const cmd = document.getElementById("terminalInput").value;
    fetch(`${LYRA_API_URL}/terminal`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ command: cmd })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("terminalOutput").value += `> ${cmd}\n${data.output}\n`;
        document.getElementById("terminalInput").value = "";
    });
}

function appendMessage(sender, msg) {
    document.getElementById("chatLog").innerHTML += `<p><b>${sender}:</b> ${msg}</p>`;
}
</script>
</body>
</html>
